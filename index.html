<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Font Awesome-->
    <script src="https://kit.fontawesome.com/92992f5a3f.js" crossorigin="anonymous"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="stylesheets/index.css">
    <link rel="icon" type="image/gif/png" href="favicon.png">
    <title>To-Do List</title>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-tasks d-inline-block" width="30" height="30" alt="Image brand"></i>
                Everyday To-Do List
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText"
                aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item active">
                        <a class="nav-link" href="index.html">Dashboard <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="todo.html">To-Do List</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <h1 class="text-center">Welcome to Your Dashboard!</h1>

    <div class="container progress-bars">
        <label for="incomplete">Incompleted Tasks:</label>
        <div class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" role="progressbar"
                id="incomplete"><span id="incompletePercent"></span></div>
        </div>
        <label for="complete">Completed Tasks:</label>
        <div class="progress">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" role="progressbar"
                id="complete"><span id="completedPercent"></span></div>
        </div>

        <p>
            The Total number of tasks in the list: <span id="totalNumTasks"></span>
        </p>

        <p>
            The current number of tasks marked complete: <span id="completedTasks"></span>
        </p>

        <p>
            The current number of tasks marked incomplete: <span id="incompleteTasks"></span>
        </p>
    </div>

    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/3.1.0/mustache.js"></script>
    <script>
       // Get tasks
        $.ajax({
            type: 'GET',
            url: '/api/tasks.php',
            dataType: 'json',
            success: function(tasks) {
                // Update the total number of tasks
                var totalNumTasks = tasks.length;
                $('#totalNumTasks').text(totalNumTasks);

                // Get the number of completed tasks
                var completedTasks = 0;
                var incompleteTasks = 0;
                $.each(tasks, function(index, task){
                    if (task.complete) {
                        completedTasks++;
                    } else {
                        incompleteTasks++;
                    }
                });

                // Update text fields for completed tasks and incompleted tasks
                $('#completedTasks').text(completedTasks);
                $('#incompleteTasks').text(incompleteTasks);

                // Update progress bars
                var incompletePercent = Math.round((incompleteTasks / totalNumTasks) * 100);
                var completedPercent = 100 - incompletePercent;
                $('#incompletePercent').text(incompletePercent.toString() + '%');
                $('#completedPercent').text(completedPercent.toString() + "%");
                $('#incomplete').css('width', incompletePercent.toString() + '%');
                $('#complete').css('width', completedPercent.toString() + '%');

            },
            error: function() {
                alert('Error loading tasks');
            }
        }); 
    </script>
</body>
</html>